# RAG-Enhanced Risk Assessment Flow

## Before (Hardcoded Rules)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Loan Applicationâ”‚
â”‚                 â”‚
â”‚ â€¢ Credit: 650   â”‚
â”‚ â€¢ Income: $75K  â”‚
â”‚ â€¢ Loan: $300K   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hardcoded Logic    â”‚
â”‚                     â”‚
â”‚  if score < 580:    â”‚
â”‚    risk += 40       â”‚
â”‚  elif score < 670:  â”‚
â”‚    risk += 25       â”‚
â”‚                     â”‚
â”‚  if dti > 0.43:     â”‚
â”‚    risk += 30       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Risk Score: 25      â”‚
â”‚                     â”‚
â”‚ Factors:            â”‚
â”‚ â€¢ Below avg credit  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Limitations:**
- âŒ Thresholds hardcoded in Python
- âŒ Can't easily change policies
- âŒ No context on WHY rules exist
- âŒ Limited to simple numeric checks

---

## After (Document-Informed with RAG)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Loan Applicationâ”‚
â”‚                 â”‚
â”‚ â€¢ Credit: 650   â”‚
â”‚ â€¢ Income: $75K  â”‚
â”‚ â€¢ Loan: $300K   â”‚
â”‚ â€¢ DTI: 38%      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vector Store Query              â”‚
â”‚                                   â”‚
â”‚   "Loan for home purchase         â”‚
â”‚    $300K, income $75K,            â”‚
â”‚    credit 650, employed"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Semantic Search                 â”‚
â”‚   (Chroma Vector Store)           â”‚
â”‚                                   â”‚
â”‚   Retrieves top 5 documents       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Retrieved Documents             â”‚
â”‚                                   â”‚
â”‚   ğŸ“„ Credit Score Requirements    â”‚
â”‚      â€¢ 740-850: Excellent         â”‚
â”‚      â€¢ 670-739: Good (max $500K)  â”‚
â”‚      â€¢ 580-669: Fair (max $250K)  â”‚
â”‚                                   â”‚
â”‚   ğŸ“„ DTI Guidelines               â”‚
â”‚      â€¢ â‰¤36%: Standard approval    â”‚
â”‚      â€¢ 37-43%: Need comp factors  â”‚
â”‚      â€¢ >43%: High risk            â”‚
â”‚                                   â”‚
â”‚   ğŸ“„ Employment Requirements      â”‚
â”‚      â€¢ Min 2 years stability      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM Analysis                    â”‚
â”‚   (GPT-4)                         â”‚
â”‚                                   â”‚
â”‚   Prompt:                         â”‚
â”‚   "Based on these internal        â”‚
â”‚    rules, analyze this loan..."   â”‚
â”‚                                   â”‚
â”‚   Context:                        â”‚
â”‚   â€¢ Retrieved policy documents    â”‚
â”‚   â€¢ Applicant details             â”‚
â”‚   â€¢ Calculated ratios             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM Response (Structured)       â”‚
â”‚                                   â”‚
â”‚   RISK_FACTORS:                   â”‚
â”‚   â€¢ Credit 650 = "Fair" tier      â”‚
â”‚     (per policy section 1.3)      â”‚
â”‚   â€¢ Exceeds $250K Fair limit      â”‚
â”‚   â€¢ DTI 38% needs comp factors    â”‚
â”‚     (per section 2.2)             â”‚
â”‚                                   â”‚
â”‚   RISK_SCORE: 65                  â”‚
â”‚                                   â”‚
â”‚   RULE_CONSIDERATIONS:            â”‚
â”‚   â€¢ Policy caps Fair credit at    â”‚
â”‚     $250K without exception       â”‚
â”‚   â€¢ Senior approval needed for    â”‚
â”‚     amount over tier limit        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Parsed Risk Assessment          â”‚
â”‚                                   â”‚
â”‚   Risk Score: 65                  â”‚
â”‚   Risk Factors (3):               â”‚
â”‚   1. Credit in Fair tier          â”‚
â”‚   2. Exceeds policy limit         â”‚
â”‚   3. DTI requires review          â”‚
â”‚                                   â”‚
â”‚   Decision: APPROVED (reduced)    â”‚
â”‚   Amount: $187,500 (75%)          â”‚
â”‚   Rate: 6.75%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Advantages:**
- âœ… **Policy-driven**: Rules from documents
- âœ… **Transparent**: Cites specific policies
- âœ… **Flexible**: Update docs, not code
- âœ… **Contextual**: Understands rule intent
- âœ… **Auditable**: Trace decision to source

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Loan Approval Agent               â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. validate_request()                      â”‚  â”‚
â”‚  â”‚    â€¢ Check for missing info                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                   â”‚
â”‚               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. retrieve_rules()                 â—„â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤ Vector Store
â”‚  â”‚    â€¢ Build semantic query                  â”‚  â”‚  (Chroma)
â”‚  â”‚    â€¢ Search documents (k=5)                â”‚  â”‚   â†“
â”‚  â”‚    â€¢ Filter by permissions           â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”¤ PDF Documents
â”‚  â”‚    â€¢ Store in state                  â”‚     â”‚  â”‚ â€¢ internal_rules.pdf
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜     â”‚  â”‚ â€¢ public_guidelines.pdf
â”‚               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤
â”‚               â–¼                               â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. assess_risk() â˜… ENHANCED â˜…             â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚    â”‚ If documents available:           â”‚   â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Format top 3 as context         â”‚   â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Build detailed prompt     â—„â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”¤ LLM
â”‚  â”‚    â”‚ â€¢ Invoke LLM with rules+app       â”‚   â”‚  â”‚ (GPT-4)
â”‚  â”‚    â”‚ â€¢ Parse response                  â”‚   â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Extract risk factors & score    â”‚   â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚    â”‚ Fallback (no docs):               â”‚   â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Basic calculation               â”‚   â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Hardcoded thresholds            â”‚   â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                   â”‚
â”‚               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. make_decision()                         â”‚  â”‚
â”‚  â”‚    â€¢ Approve/deny based on risk score      â”‚  â”‚
â”‚  â”‚    â€¢ Set amount and rate                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Loan Decision â”‚
         â”‚ â€¢ Outcome     â”‚
         â”‚ â€¢ Risk score  â”‚
         â”‚ â€¢ Amount      â”‚
         â”‚ â€¢ Rate        â”‚
         â”‚ â€¢ Reasons     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: State Object

```python
AgentState (TypedDict)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  messages: [...]                                â”‚
â”‚  request: LoanRequest(                          â”‚
â”‚    applicant_name="John Doe",                   â”‚
â”‚    credit_score=650,                            â”‚
â”‚    ...                                          â”‚
â”‚  )                                              â”‚
â”‚  decision: None  â”€â”€â–º Populated in step 4        â”‚
â”‚                                                 â”‚
â”‚  retrieved_documents: [        â—„â”€â”€ NEW FIELD   â”‚
â”‚    "Credit Score Requirements:\n...",           â”‚
â”‚    "DTI Ratio Guidelines:\n...",                â”‚
â”‚    "Employment verification:\n..."             â”‚
â”‚  ]  â”€â”€â–º Used in step 3 (assess_risk)           â”‚
â”‚                                                 â”‚
â”‚  risk_factors: []  â”€â”€â–º Populated in step 3      â”‚
â”‚  documents_checked: False                       â”‚
â”‚  security_context: SecurityContext(...)         â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## LLM Prompt Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  System Role:                                       â”‚
â”‚  "You are a loan risk analyst"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTERNAL LOAN RULES:                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  --- Document 1 ---                                 â”‚
â”‚  Credit Score Requirements:                         â”‚
â”‚  â€¢ 740-850: Excellent (no limit, 5% down)           â”‚
â”‚  â€¢ 670-739: Good (max $500K, 10% down)              â”‚
â”‚  â€¢ 580-669: Fair (max $250K, 20% down)              â”‚
â”‚  â€¢ Below 580: Poor (case-by-case, 30%+ down)        â”‚
â”‚                                                     â”‚
â”‚  --- Document 2 ---                                 â”‚
â”‚  Debt-to-Income (DTI) Ratio Guidelines:             â”‚
â”‚  â€¢ DTI â‰¤ 36%: Preferred - standard approval         â”‚
â”‚  â€¢ DTI 37-43%: Acceptable with compensating factors â”‚
â”‚  â€¢ DTI 44-50%: Requires senior approval             â”‚
â”‚  â€¢ DTI > 50%: Generally declined                    â”‚
â”‚                                                     â”‚
â”‚  --- Document 3 ---                                 â”‚
â”‚  Employment Requirements:                           â”‚
â”‚  â€¢ Minimum 2 years at current employer              â”‚
â”‚  â€¢ Self-employed: 2 years tax returns required      â”‚
â”‚  â€¢ Unemployment: automatic decline                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOAN APPLICATION:                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  â€¢ Applicant: John Doe                              â”‚
â”‚  â€¢ Loan Amount: $300,000.00                         â”‚
â”‚  â€¢ Loan Purpose: Home purchase                      â”‚
â”‚  â€¢ Annual Income: $75,000.00                        â”‚
â”‚  â€¢ Credit Score: 650                                â”‚
â”‚  â€¢ Employment: employed (3 years)                   â”‚
â”‚  â€¢ Existing Debts: $15,000.00                       â”‚
â”‚  â€¢ DTI Ratio: 38.0%                                 â”‚
â”‚  â€¢ Collateral Value: $350,000.00                    â”‚
â”‚  â€¢ LTV Ratio: 85.7%                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Instructions:                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  Based on the internal rules, provide:              â”‚
â”‚  1. List of risk factors that violate/concern rulesâ”‚
â”‚  2. Risk score 0-100 (0=lowest, 100=highest)        â”‚
â”‚  3. Key considerations from rules                   â”‚
â”‚                                                     â”‚
â”‚  Format:                                            â”‚
â”‚  RISK_FACTORS: [list]                               â”‚
â”‚  RISK_SCORE: [number]                               â”‚
â”‚  RULE_CONSIDERATIONS: [points]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling & Fallback

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   assess_risk()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Documents    â”‚â”€â”€â”€â”€â”€ YES â”€â”€â”
    â”‚ available?   â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
           â”‚                    â”‚
           NO                   â–¼
           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚          â”‚ Try LLM Analysis â”‚
           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
           â”‚              â”‚           â”‚
           â”‚           SUCCESS      ERROR
           â”‚              â”‚           â”‚
           â”‚              â–¼           â”‚
           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
           â”‚          â”‚ Parse  â”‚     â”‚
           â”‚          â”‚Responseâ”‚     â”‚
           â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜     â”‚
           â”‚               â”‚         â”‚
           â”‚            SUCCESS    ERROR
           â”‚               â”‚         â”‚
           â”‚               â–¼         â”‚
           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
           â”‚          â”‚ Return â”‚    â”‚
           â”‚          â”‚ Result â”‚    â”‚
           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
           â”‚                        â”‚
           â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   _calculate_basic_risk()        â”‚
    â”‚   (Fallback Method)              â”‚
    â”‚                                  â”‚
    â”‚   â€¢ Hardcoded thresholds         â”‚
    â”‚   â€¢ Simple numeric calculation   â”‚
    â”‚   â€¢ Always works                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Return Resultâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Fallback Triggers:**
1. No documents in vector store
2. Vector store query fails
3. LLM API error
4. Response parsing fails
5. Empty/invalid LLM response

**Result:** Agent always returns a decision, even if falling back to basic logic.

---

## Policy Update Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Policy Change   â”‚
â”‚ (Business Team) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Document Source    â”‚
â”‚ scripts/                  â”‚
â”‚   generate_loan_docs.py   â”‚
â”‚                           â”‚
â”‚ â€¢ Modify credit tiers     â”‚
â”‚ â€¢ Update DTI thresholds   â”‚
â”‚ â€¢ Change requirements     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate PDFs             â”‚
â”‚ $ make generate-docs      â”‚
â”‚                           â”‚
â”‚ Creates:                  â”‚
â”‚ â€¢ internal_loan_rules.pdf â”‚
â”‚ â€¢ public_guidelines.pdf   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load to Vector Store      â”‚
â”‚ $ make load-docs          â”‚
â”‚                           â”‚
â”‚ â€¢ Chunks documents        â”‚
â”‚ â€¢ Creates embeddings      â”‚
â”‚ â€¢ Stores in Chroma        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent Auto-Updates! ğŸ‰    â”‚
â”‚                           â”‚
â”‚ â€¢ Next request uses       â”‚
â”‚   new rules               â”‚
â”‚ â€¢ No code changes         â”‚
â”‚ â€¢ No deployment           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Time to Update Policy:** < 5 minutes  
**Code Changes Required:** 0  
**Deployment Required:** No  

---

## Summary

### Key Innovation
Transform credit risk assessment from **hardcoded logic** to **policy-driven analysis** using RAG.

### Technical Components
1. **Vector Store** (Chroma) - Stores policy documents
2. **Embeddings** (OpenAI) - Semantic search
3. **LLM** (GPT-4) - Policy interpretation
4. **Fallback** - Ensures reliability

### Business Value
- âœ… Faster policy updates
- âœ… Transparent decisions
- âœ… Audit trail
- âœ… Compliance-ready
- âœ… Consistent with documentation
